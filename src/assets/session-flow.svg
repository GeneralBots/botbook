<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450">
  <defs>
    <linearGradient id="bgGradSession" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16213e;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="nodeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0f3460;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1a1a2e;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowSession" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4ade80"/>
    </marker>
    <marker id="arrowPink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f472b6"/>
    </marker>
    <marker id="arrowYellow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#fbbf24"/>
    </marker>
    <filter id="glowSession">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="800" height="450" fill="url(#bgGradSession)" rx="12"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="20" font-weight="bold">Session Flow Diagram</text>
  <text x="400" y="55" text-anchor="middle" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="12">User → Session → Message Relationships</text>

  <!-- User Node -->
  <g transform="translate(80, 140)">
    <rect width="120" height="100" rx="10" fill="url(#nodeGrad)" stroke="#60a5fa" stroke-width="3" filter="url(#glowSession)"/>
    <rect width="120" height="30" rx="10" fill="#60a5fa"/>
    <text x="60" y="20" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">User</text>
    <circle cx="60" cy="60" r="20" fill="#1a1a2e" stroke="#60a5fa" stroke-width="2"/>
    <circle cx="60" cy="55" r="8" fill="#60a5fa"/>
    <path d="M45 75 Q60 85 75 75" fill="none" stroke="#60a5fa" stroke-width="2"/>
  </g>

  <!-- Bot Node -->
  <g transform="translate(80, 290)">
    <rect width="120" height="100" rx="10" fill="url(#nodeGrad)" stroke="#4ade80" stroke-width="3" filter="url(#glowSession)"/>
    <rect width="120" height="30" rx="10" fill="#4ade80"/>
    <text x="60" y="20" text-anchor="middle" fill="#1a1a2e" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">Bot</text>
    <rect x="35" y="45" width="50" height="40" rx="6" fill="#1a1a2e" stroke="#4ade80" stroke-width="2"/>
    <circle cx="50" cy="60" r="4" fill="#4ade80"/>
    <circle cx="70" cy="60" r="4" fill="#4ade80"/>
    <path d="M45 72 Q60 78 75 72" fill="none" stroke="#4ade80" stroke-width="2"/>
  </g>

  <!-- Session Node (Center) -->
  <g transform="translate(300, 180)">
    <rect width="140" height="130" rx="10" fill="url(#nodeGrad)" stroke="#f472b6" stroke-width="3" filter="url(#glowSession)"/>
    <rect width="140" height="30" rx="10" fill="#f472b6"/>
    <text x="70" y="20" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">Session</text>
    <text x="15" y="50" fill="#a0a0a0" font-family="monospace" font-size="9">id: uuid</text>
    <text x="15" y="65" fill="#a0a0a0" font-family="monospace" font-size="9">user_id: fk</text>
    <text x="15" y="80" fill="#a0a0a0" font-family="monospace" font-size="9">bot_id: fk</text>
    <text x="15" y="95" fill="#a0a0a0" font-family="monospace" font-size="9">started_at</text>
    <text x="15" y="110" fill="#a0a0a0" font-family="monospace" font-size="9">last_active</text>
  </g>

  <!-- Messages Node -->
  <g transform="translate(520, 130)">
    <rect width="140" height="110" rx="10" fill="url(#nodeGrad)" stroke="#fbbf24" stroke-width="3" filter="url(#glowSession)"/>
    <rect width="140" height="30" rx="10" fill="#fbbf24"/>
    <text x="70" y="20" text-anchor="middle" fill="#1a1a2e" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">Messages</text>
    <text x="15" y="50" fill="#a0a0a0" font-family="monospace" font-size="9">id: uuid</text>
    <text x="15" y="65" fill="#a0a0a0" font-family="monospace" font-size="9">session_id: fk</text>
    <text x="15" y="80" fill="#a0a0a0" font-family="monospace" font-size="9">role: user|bot</text>
    <text x="15" y="95" fill="#a0a0a0" font-family="monospace" font-size="9">content: text</text>
  </g>

  <!-- Knowledge Base Node -->
  <g transform="translate(520, 280)">
    <rect width="140" height="100" rx="10" fill="url(#nodeGrad)" stroke="#a78bfa" stroke-width="3" filter="url(#glowSession)"/>
    <rect width="140" height="30" rx="10" fill="#a78bfa"/>
    <text x="70" y="20" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">KB Collection</text>
    <text x="15" y="50" fill="#a0a0a0" font-family="monospace" font-size="9">id: uuid</text>
    <text x="15" y="65" fill="#a0a0a0" font-family="monospace" font-size="9">name</text>
    <text x="15" y="80" fill="#a0a0a0" font-family="monospace" font-size="9">documents[]</text>
  </g>

  <!-- Connection Lines -->
  <!-- User to Session -->
  <path d="M200 190 L300 220" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowSession)"/>
  <text x="235" y="195" fill="#60a5fa" font-family="system-ui, sans-serif" font-size="10">1:N</text>

  <!-- Bot to Session -->
  <path d="M200 340 L300 280" stroke="#4ade80" stroke-width="2" fill="none" marker-end="url(#arrowSession)"/>
  <text x="235" y="325" fill="#4ade80" font-family="system-ui, sans-serif" font-size="10">1:N</text>

  <!-- Session to Messages -->
  <path d="M440 200 L520 185" stroke="#f472b6" stroke-width="2" fill="none" marker-end="url(#arrowPink)"/>
  <text x="470" y="182" fill="#f472b6" font-family="system-ui, sans-serif" font-size="10">1:N</text>

  <!-- Session to KB -->
  <path d="M440 280 L520 310" stroke="#a78bfa" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  <text x="470" y="305" fill="#a78bfa" font-family="system-ui, sans-serif" font-size="10">N:1</text>

  <!-- Flow Description -->
  <g transform="translate(700, 140)">
    <rect x="-20" y="-10" width="100" height="220" rx="8" fill="#0f3460" opacity="0.5"/>
    <text x="30" y="10" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="11" font-weight="bold">Flow</text>

    <circle cx="10" cy="40" r="8" fill="#60a5fa"/>
    <text x="10" y="44" text-anchor="middle" fill="#fff" font-family="system-ui, sans-serif" font-size="9">1</text>
    <text x="30" y="44" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="9">Connect</text>

    <circle cx="10" cy="75" r="8" fill="#4ade80"/>
    <text x="10" y="79" text-anchor="middle" fill="#1a1a2e" font-family="system-ui, sans-serif" font-size="9">2</text>
    <text x="30" y="79" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="9">Select Bot</text>

    <circle cx="10" cy="110" r="8" fill="#f472b6"/>
    <text x="10" y="114" text-anchor="middle" fill="#fff" font-family="system-ui, sans-serif" font-size="9">3</text>
    <text x="30" y="114" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="9">Session</text>

    <circle cx="10" cy="145" r="8" fill="#fbbf24"/>
    <text x="10" y="149" text-anchor="middle" fill="#1a1a2e" font-family="system-ui, sans-serif" font-size="9">4</text>
    <text x="30" y="149" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="9">Chat</text>

    <circle cx="10" cy="180" r="8" fill="#a78bfa"/>
    <text x="10" y="184" text-anchor="middle" fill="#fff" font-family="system-ui, sans-serif" font-size="9">5</text>
    <text x="30" y="184" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="9">Query KB</text>
  </g>

  <!-- Legend -->
  <g transform="translate(50, 410)">
    <text x="0" y="0" fill="#ffffff" font-family="system-ui, sans-serif" font-size="11" font-weight="bold">Relationships:</text>
    <line x1="100" y1="-5" x2="140" y2="-5" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowSession)"/>
    <text x="150" y="0" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="10">One-to-Many (1:N)</text>
    <line x1="280" y1="-5" x2="320" y2="-5" stroke="#a78bfa" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="330" y="0" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="10">Many-to-One (N:1)</text>
    <text x="500" y="0" fill="#a0a0a0" font-family="system-ui, sans-serif" font-size="10">fk = Foreign Key</text>
  </g>
</svg>
